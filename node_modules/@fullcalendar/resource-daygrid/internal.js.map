{"version":3,"file":"internal.js","sources":["../src/ResourceDayTableJoiner.ts","../src/ResourceDayTable.tsx","../src/ResourceDayTableView.tsx"],"sourcesContent":["import { TableSeg } from '@fullcalendar/daygrid/internal'\nimport { AbstractResourceDayTableModel, VResourceJoiner } from '@fullcalendar/resource/internal'\n\nexport class ResourceDayTableJoiner extends VResourceJoiner<TableSeg> {\n  transformSeg(seg: TableSeg, resourceDayTableModel: AbstractResourceDayTableModel, resourceI: number): TableSeg[] {\n    let colRanges = resourceDayTableModel.computeColRanges(seg.firstCol, seg.lastCol, resourceI)\n\n    return colRanges.map((colRange) => ({\n      ...seg,\n      ...colRange,\n      isStart: seg.isStart && colRange.isStart,\n      isEnd: seg.isEnd && colRange.isEnd,\n    }))\n  }\n}\n","import { Duration, CssDimValue } from '@fullcalendar/core'\nimport {\n  mapHash, Hit, DateSpan, DateComponent, EventStore, EventUiHash, EventInteractionState, DateProfile,\n} from '@fullcalendar/core/internal'\nimport { createElement, createRef, VNode, RefObject } from '@fullcalendar/core/preact'\nimport { DayTableSlicer, Table } from '@fullcalendar/daygrid/internal'\nimport { AbstractResourceDayTableModel, VResourceSplitter } from '@fullcalendar/resource/internal'\nimport { ResourceDayTableJoiner } from './ResourceDayTableJoiner.js'\n\nexport interface ResourceDayTableProps {\n  dateProfile: DateProfile\n  resourceDayTableModel: AbstractResourceDayTableModel\n  businessHours: EventStore\n  eventStore: EventStore\n  eventUiBases: EventUiHash\n  dateSelection: DateSpan | null\n  eventSelection: string\n  eventDrag: EventInteractionState | null\n  eventResize: EventInteractionState | null\n  nextDayThreshold: Duration\n  tableMinWidth: CssDimValue\n  colGroupNode: VNode\n  renderRowIntro?: () => VNode\n  dayMaxEvents: boolean | number\n  dayMaxEventRows: boolean | number\n  expandRows: boolean\n  showWeekNumbers: boolean\n  headerAlignElRef?: RefObject<HTMLElement> // for more popover alignment\n  clientWidth: number | null\n  clientHeight: number | null\n  forPrint: boolean\n}\n\nexport class ResourceDayTable extends DateComponent<ResourceDayTableProps> {\n  private splitter = new VResourceSplitter()\n  private slicers: { [resourceId: string]: DayTableSlicer } = {}\n  private joiner = new ResourceDayTableJoiner()\n  private tableRef = createRef<Table>()\n\n  render() {\n    let { props, context } = this\n    let { resourceDayTableModel, nextDayThreshold, dateProfile } = props\n\n    let splitProps = this.splitter.splitProps(props)\n    this.slicers = mapHash(splitProps, (split, resourceId) => this.slicers[resourceId] || new DayTableSlicer())\n    let slicedProps = mapHash(this.slicers, (slicer, resourceId) => slicer.sliceProps(\n      splitProps[resourceId],\n      dateProfile,\n      nextDayThreshold,\n      context,\n      resourceDayTableModel.dayTableModel,\n    ))\n\n    return (\n      <Table\n        forPrint={props.forPrint}\n        ref={this.tableRef}\n        {...this.joiner.joinProps(slicedProps, resourceDayTableModel)}\n        cells={resourceDayTableModel.cells}\n        dateProfile={dateProfile}\n        colGroupNode={props.colGroupNode}\n        tableMinWidth={props.tableMinWidth}\n        renderRowIntro={props.renderRowIntro}\n        dayMaxEvents={props.dayMaxEvents}\n        dayMaxEventRows={props.dayMaxEventRows}\n        showWeekNumbers={props.showWeekNumbers}\n        expandRows={props.expandRows}\n        headerAlignElRef={props.headerAlignElRef}\n        clientWidth={props.clientWidth}\n        clientHeight={props.clientHeight}\n        isHitComboAllowed={this.isHitComboAllowed}\n      />\n    )\n  }\n\n  isHitComboAllowed = (hit0: Hit, hit1: Hit) => {\n    let allowAcrossResources = this.props.resourceDayTableModel.dayTableModel.colCnt === 1\n    return allowAcrossResources || hit0.dateSpan.resourceId === hit1.dateSpan.resourceId\n  }\n}\n","import {\n  DateProfileGenerator,\n  memoize,\n  DateProfile,\n  ChunkContentCallbackArgs,\n  CalendarContext,\n} from '@fullcalendar/core/internal'\nimport {\n  createElement,\n  createRef,\n} from '@fullcalendar/core/preact'\nimport { TableView, buildDayTableModel } from '@fullcalendar/daygrid/internal'\nimport {\n  ResourceDayHeader, ResourceDayTableModel, DayResourceTableModel, ResourceViewProps,\n  Resource, flattenResources, DEFAULT_RESOURCE_ORDER,\n} from '@fullcalendar/resource/internal'\nimport { ResourceDayTable } from './ResourceDayTable.js'\n\nexport class ResourceDayTableView extends TableView {\n  props: ResourceViewProps\n\n  private flattenResources = memoize(flattenResources)\n  private buildResourceDayTableModel = memoize(buildResourceDayTableModel)\n  private headerRef = createRef<ResourceDayHeader>()\n  private tableRef = createRef<ResourceDayTable>()\n\n  render() {\n    let { props, context } = this\n    let { options } = context\n\n    let resourceOrderSpecs = options.resourceOrder || DEFAULT_RESOURCE_ORDER\n    let resources = this.flattenResources(props.resourceStore, resourceOrderSpecs)\n    let resourceDayTableModel = this.buildResourceDayTableModel(\n      props.dateProfile,\n      context.dateProfileGenerator,\n      resources,\n      options.datesAboveResources,\n      context,\n    )\n\n    let headerContent = options.dayHeaders && (\n      <ResourceDayHeader\n        ref={this.headerRef}\n        resources={resources}\n        dateProfile={props.dateProfile}\n        dates={resourceDayTableModel.dayTableModel.headerDates}\n        datesRepDistinctDays\n      />\n    )\n\n    let bodyContent = (contentArg: ChunkContentCallbackArgs) => (\n      <ResourceDayTable\n        ref={this.tableRef}\n        dateProfile={props.dateProfile}\n        resourceDayTableModel={resourceDayTableModel}\n        businessHours={props.businessHours}\n        eventStore={props.eventStore}\n        eventUiBases={props.eventUiBases}\n        dateSelection={props.dateSelection}\n        eventSelection={props.eventSelection}\n        eventDrag={props.eventDrag}\n        eventResize={props.eventResize}\n        nextDayThreshold={options.nextDayThreshold}\n        tableMinWidth={contentArg.tableMinWidth}\n        colGroupNode={contentArg.tableColGroupNode}\n        dayMaxEvents={options.dayMaxEvents}\n        dayMaxEventRows={options.dayMaxEventRows}\n        showWeekNumbers={options.weekNumbers}\n        expandRows={!props.isHeightAuto}\n        headerAlignElRef={this.headerElRef}\n        clientWidth={contentArg.clientWidth}\n        clientHeight={contentArg.clientHeight}\n        forPrint={props.forPrint}\n      />\n    )\n\n    return options.dayMinWidth\n      ? this.renderHScrollLayout(headerContent, bodyContent, resourceDayTableModel.colCnt, options.dayMinWidth)\n      : this.renderSimpleLayout(headerContent, bodyContent)\n  }\n}\n\nfunction buildResourceDayTableModel(\n  dateProfile: DateProfile,\n  dateProfileGenerator: DateProfileGenerator,\n  resources: Resource[],\n  datesAboveResources: boolean,\n  context: CalendarContext,\n) {\n  let dayTable = buildDayTableModel(dateProfile, dateProfileGenerator)\n\n  return datesAboveResources ?\n    new DayResourceTableModel(dayTable, resources, context) :\n    new ResourceDayTableModel(dayTable, resources, context)\n}\n"],"names":[],"mappings":"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"}