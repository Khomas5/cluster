{"version":3,"file":"index.js","sources":["../src/global-handlers.ts","../src/index.ts"],"sourcesContent":["import {\n  findElements,\n  CalendarContext,\n  removeExact,\n  config,\n} from '@fullcalendar/core/internal'\nimport { flushSync } from '@fullcalendar/core/preact'\n\nconfig.COLLAPSIBLE_WIDTH_THRESHOLD = 1200\n\nlet contexts: CalendarContext[] = []\nlet undoFuncs: (() => void)[] = []\n\nexport function contextInit(context: CalendarContext): void {\n  if (!contexts.length) {\n    attachGlobalHandlers()\n  }\n  contexts.push(context)\n  context.calendarApi.on('_unmount', () => {\n    removeExact(contexts, context)\n    if (!contexts.length) {\n      removeGlobalHandlers()\n    }\n  })\n}\n\nfunction attachGlobalHandlers() {\n  window.addEventListener('beforeprint', handleBeforePrint)\n  window.addEventListener('afterprint', handleAfterPrint)\n\n  // // for testing\n  // let forPrint = false\n  // document.addEventListener('keypress', (ev) => {\n  //   if (ev.key === 'p') {\n  //     forPrint = !forPrint\n  //     if (forPrint) {\n  //       handleBeforePrint()\n  //     } else {\n  //       handleAfterPrint()\n  //     }\n  //   }\n  // })\n}\n\nfunction removeGlobalHandlers() {\n  window.removeEventListener('beforeprint', handleBeforePrint)\n  window.removeEventListener('afterprint', handleAfterPrint)\n}\n\nfunction handleBeforePrint() {\n  let scrollEls = queryScrollerEls()\n  let scrollCoords = queryScrollerCoords(scrollEls)\n\n  for (let context of contexts) {\n    context.emitter.trigger('_beforeprint')\n  }\n\n  flushSync(() => { // because printing grabs DOM immediately after\n    killHorizontalScrolling(scrollEls, scrollCoords)\n    undoFuncs.push(() => restoreScrollerCoords(scrollEls, scrollCoords))\n    undoFuncs.push(freezeScrollgridWidths())\n  })\n}\n\nfunction handleAfterPrint() {\n  for (let context of contexts) {\n    context.emitter.trigger('_afterprint')\n  }\n\n  flushSync(() => { // guarantee that there are real scrollers\n    while (undoFuncs.length) {\n      undoFuncs.shift()()\n    }\n  })\n}\n\n// scrollgrid widths\n\nfunction freezeScrollgridWidths() {\n  let els = findElements(document.body, '.fc-scrollgrid')\n  els.forEach(freezeScrollGridWidth)\n  return () => els.forEach(unfreezeScrollGridWidth)\n}\n\nfunction freezeScrollGridWidth(el: HTMLElement) {\n  let elWidth = el.getBoundingClientRect().width\n\n  // along with collapsibleWidth, this is a hack for #5707\n  if (!el.classList.contains('fc-scrollgrid-collapsible') || elWidth < config.COLLAPSIBLE_WIDTH_THRESHOLD) {\n    el.style.width = elWidth + 'px'\n  }\n}\n\nfunction unfreezeScrollGridWidth(el) {\n  el.style.width = ''\n}\n\n// scrollers\n// TODO: use scroll normalization!? yes\n\nfunction queryScrollerEls() {\n  return findElements(document.body, '.fc-scroller-harness > .fc-scroller')\n}\n\ninterface ScrollerCoords {\n  scrollLeft: number\n  scrollTop: number\n  overflowX: string\n  overflowY: string\n  marginBottom: string\n}\n\nfunction queryScrollerCoords(els: HTMLElement[]): ScrollerCoords[] {\n  return els.map((el) => {\n    let computedStyle = window.getComputedStyle(el)\n\n    return {\n      scrollLeft: el.scrollLeft,\n      scrollTop: el.scrollTop,\n      overflowX: computedStyle.overflowX,\n      overflowY: computedStyle.overflowY,\n      marginBottom: computedStyle.marginBottom,\n    }\n  })\n}\n\nfunction killHorizontalScrolling(els: HTMLElement[], coords: ScrollerCoords[]) {\n  els.forEach((el, i) => {\n    el.style.overflowX = 'visible' // need to clear X/Y to get true overflow\n    el.style.overflowY = 'visible' // \"\n    el.style.marginBottom = '' // for clipping away scrollbar. disable\n    el.style.left = -coords[i].scrollLeft + 'px' // simulate scrollLeft! will be position:relative\n  })\n}\n\nfunction restoreScrollerCoords(els: HTMLElement[], coords: ScrollerCoords[]) { // restores vertical scrolling too\n  els.forEach((el, i) => {\n    let c = coords[i]\n    el.style.overflowX = c.overflowX\n    el.style.overflowY = c.overflowY\n    el.style.marginBottom = c.marginBottom\n    el.style.left = ''\n    el.scrollLeft = c.scrollLeft\n    el.scrollTop = c.scrollTop\n  })\n}\n","import { createPlugin, PluginDef } from '@fullcalendar/core'\nimport premiumCommonPlugin from '@fullcalendar/premium-common'\nimport { contextInit } from './global-handlers.js'\nimport './ambient.js'\nimport './index.css'\n\nexport default createPlugin({\n  name: '<%= pkgName %>',\n  premiumReleaseDate: '<%= releaseDate %>',\n  deps: [premiumCommonPlugin],\n  contextInit,\n}) as PluginDef\n"],"names":[],"mappings":"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"}