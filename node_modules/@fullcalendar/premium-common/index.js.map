{"version":3,"file":"index.js","sources":["../src/license.tsx","../src/options-refiners.ts","../src/index.ts"],"sourcesContent":["import { config, isValidDate, addDays, CalendarContext } from '@fullcalendar/core/internal'\nimport { createElement, Fragment } from '@fullcalendar/core/preact'\n\nconst UPGRADE_WINDOW = 365 + 7 // days. 1 week leeway, for tz shift reasons too\nconst INVALID_LICENSE_URL = 'https://fullcalendar.io/docs/schedulerLicenseKey#invalid'\nconst OUTDATED_LICENSE_URL = 'https://fullcalendar.io/docs/schedulerLicenseKey#outdated'\nconst PRESET_LICENSE_KEYS = [\n  'GPL-My-Project-Is-Open-Source',\n  'CC-Attribution-NonCommercial-NoDerivatives',\n]\nconst CSS = {\n  position: 'absolute',\n  zIndex: 99999,\n  bottom: '1px',\n  left: '1px',\n  background: '#eee',\n  borderColor: '#ddd',\n  borderStyle: 'solid',\n  borderWidth: '1px 1px 0 0',\n  padding: '2px 4px',\n  fontSize: '12px',\n  borderTopRightRadius: '3px',\n}\n\nexport function buildLicenseWarning(context: CalendarContext) {\n  let key = context.options.schedulerLicenseKey\n  let currentUrl = typeof window !== 'undefined' ? window.location.href : ''\n\n  if (!isImmuneUrl(currentUrl)) {\n    let status = processLicenseKey(key, context.pluginHooks.premiumReleaseDate!)\n\n    if (status !== 'valid') {\n      return (\n        <div className=\"fc-license-message\" style={CSS}>\n          {(status === 'outdated') ? (\n            <Fragment>\n              {'Your license key is too old to work with this version. '}\n              <a href={OUTDATED_LICENSE_URL}>More Info</a>\n            </Fragment>\n          ) : (\n            <Fragment>\n              {'Your license key is invalid. '}\n              <a href={INVALID_LICENSE_URL}>More Info</a>\n            </Fragment>\n          )}\n        </div>\n      )\n    }\n  }\n\n  return null\n}\n\n/*\nThis decryption is not meant to be bulletproof. Just a way to remind about an upgrade.\n*/\nfunction processLicenseKey(key, premiumReleaseDate: Date) {\n  if (PRESET_LICENSE_KEYS.indexOf(key) !== -1) {\n    return 'valid'\n  }\n\n  const parts = (key || '').match(/^(\\d+)-fcs-(\\d+)$/)\n\n  if (parts && (parts[1].length === 10)) {\n    const purchaseDate = new Date(parseInt(parts[2], 10) * 1000)\n    const releaseDate = config.mockSchedulerReleaseDate || premiumReleaseDate\n\n    if (isValidDate(releaseDate)) { // token won't be replaced in dev mode\n      const minPurchaseDate = addDays(releaseDate, -UPGRADE_WINDOW)\n\n      if (minPurchaseDate < purchaseDate) {\n        return 'valid'\n      }\n\n      return 'outdated'\n    }\n  }\n\n  return 'invalid'\n}\n\nfunction isImmuneUrl(url) {\n  return /\\w+:\\/\\/fullcalendar\\.io\\/|\\/examples\\/[\\w-]+\\.html$/.test(url)\n}\n","\nexport const OPTION_REFINERS = {\n  schedulerLicenseKey: String,\n}\n","import { createPlugin, PluginDef } from '@fullcalendar/core'\nimport { buildLicenseWarning } from './license.js'\nimport { OPTION_REFINERS } from './options-refiners.js'\nimport './ambient.js'\n\nexport default createPlugin({\n  name: '<%= pkgName %>',\n  premiumReleaseDate: '<%= releaseDate %>',\n  optionRefiners: OPTION_REFINERS,\n  viewContainerAppends: [buildLicenseWarning],\n}) as PluginDef\n"],"names":[],"mappings":"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"}